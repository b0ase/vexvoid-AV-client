<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>V3XV0ID Image Animator - Controls</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Courier New', 'Courier Prime', monospace;
      background: #000000;
      color: #ffffff;
      overflow: hidden;
      font-size: 12px;
      line-height: 1.0;
      font-weight: normal;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      cursor: crosshair;
      position: relative;
    }

    /* Scan lines effect */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(255, 255, 255, 0.005) 2px,
        rgba(255, 255, 255, 0.005) 4px
      );
      pointer-events: none;
      z-index: 1000;
    }

    /* V3XV0ID branding header */
    .v3xv0id-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.95);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding: 12px 20px;
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .v3xv0id-brand {
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 16px;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      text-shadow: 0 0 3px rgba(255, 255, 255, 0.8);
    }

    .v3xv0id-subtitle {
      font-family: 'Courier New', monospace;
      font-size: 10px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .cyber-text {
      color: #ffffff;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
    }

    /* Tab Navigation */
    .tab-navigation {
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.9);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding: 0 20px;
      z-index: 998;
      display: flex;
      gap: 2px;
    }

    .tab-button {
      background: rgba(0, 0, 0, 0.6);
      color: #888;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-bottom: none;
      padding: 10px 20px;
      cursor: crosshair;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      transition: all 0.2s;
      position: relative;
    }

    .tab-button:hover {
      color: #ffffff;
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .tab-button.active {
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border-color: rgba(255, 255, 255, 0.5);
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
    }

    .tab-button.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 1px;
      background: rgba(0, 0, 0, 0.8);
    }

    .main-container {
      display: flex;
      height: 100vh;
      gap: 15px;
      padding: 110px 15px 15px 15px;
      box-sizing: border-box;
    }

    .tab-content {
      display: none;
      width: 100%;
      height: 100%;
    }

    .tab-content.active {
      display: flex;
      gap: 15px;
    }

    /* ========== TAB CONTENT STYLES ========== */
    
    /* Video Browser Styles */
    .video-browser-container, .image-browser-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .video-browser-header, .image-browser-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .video-browser-controls, .image-browser-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .cloud-status {
      font-family: 'Courier New', monospace;
      font-size: 10px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 4px 8px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 2px;
    }

    .cloud-status.connected {
      color: #00ff00;
      border-color: rgba(0, 255, 0, 0.3);
      background: rgba(0, 255, 0, 0.1);
    }

    .cloud-status.demo {
      color: #ffaa00;
      border-color: rgba(255, 170, 0, 0.3);
      background: rgba(255, 170, 0, 0.1);
    }

    .cloud-status.error {
      color: #ff0000;
      border-color: rgba(255, 0, 0, 0.3);
      background: rgba(255, 0, 0, 0.1);
    }

    .browser-btn {
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 8px 15px;
      cursor: crosshair;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.2s;
    }

    .browser-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .search-input {
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 8px 12px;
      font-family: 'Courier New', monospace;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      width: 200px;
    }

    .search-input::placeholder {
      color: #888;
    }

    .video-library, .image-library {
      flex: 1;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
    }

    .video-grid, .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }

    .video-item, .image-item {
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 10px;
      cursor: crosshair;
      transition: all 0.2s;
      text-align: center;
    }

    .video-item:hover, .image-item:hover {
      border-color: rgba(255, 255, 255, 0.5);
      background: rgba(255, 255, 255, 0.05);
    }

    .video-thumbnail, .image-thumbnail {
      width: 100%;
      height: 80px;
      background: rgba(255, 255, 255, 0.1);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .video-name, .image-name {
      font-family: 'Courier New', monospace;
      font-size: 9px;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Pattern Generator Styles */
    .patterns-container {
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-columns: 1fr 400px;
      grid-template-rows: auto 1fr auto;
      gap: 15px;
      grid-template-areas:
        "header header"
        "studio preview"
        "library targets";
    }

    .patterns-header {
      grid-area: header;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .pattern-status {
      display: flex;
      gap: 15px;
      font-family: 'Courier New', monospace;
      font-size: 10px;
      color: #888;
      text-transform: uppercase;
    }

    .pattern-studio {
      grid-area: studio;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .pattern-editor {
      flex: 1;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
    }

    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .editor-controls {
      display: flex;
      gap: 8px;
    }

    .pattern-btn {
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 6px 12px;
      cursor: crosshair;
      font-family: 'Courier New', monospace;
      font-size: 9px;
      text-transform: uppercase;
      transition: all 0.2s;
    }

    .pattern-btn.run:hover {
      background: #00ff00;
      color: #000000;
    }

    .pattern-btn.stop:hover {
      background: #ff0000;
      color: #ffffff;
    }

    .code-editor {
      width: 100%;
      height: 300px;
      background: rgba(0, 0, 0, 0.9);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      resize: vertical;
    }

    .pattern-preview {
      grid-area: preview;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
    }

    .preview-container {
      width: 100%;
      height: 400px;
      background: rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 15px;
    }

    /* Music Player Styles */
    .music-player-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .music-player-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .music-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .music-library-section {
      flex: 1;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
      overflow-y: auto;
    }

    .music-library {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .music-track-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      cursor: crosshair;
      transition: all 0.2s;
    }

    .music-track-item:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .music-track-item.playing {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.6);
    }

    .track-number {
      font-family: 'Courier New', monospace;
      font-size: 10px;
      color: #888;
      min-width: 30px;
    }

    .track-details {
      flex: 1;
    }

    .track-name {
      font-family: 'Courier New', monospace;
      font-size: 11px;
      color: #ffffff;
      text-transform: uppercase;
      font-weight: bold;
    }

    .track-meta {
      font-family: 'Courier New', monospace;
      font-size: 9px;
      color: #888;
      text-transform: uppercase;
    }

    .track-duration {
      font-family: 'Courier New', monospace;
      font-size: 10px;
      color: #888;
    }

    .audio-player {
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .player-info {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .track-artwork {
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .artwork-placeholder {
      font-size: 24px;
    }

    .track-title {
      font-family: 'Courier New', monospace;
      font-size: 14px;
      color: #ffffff;
      font-weight: bold;
      text-transform: uppercase;
    }

    .track-artist {
      font-family: 'Courier New', monospace;
      font-size: 11px;
      color: #888;
      text-transform: uppercase;
    }

    .track-format {
      font-family: 'Courier New', monospace;
      font-size: 9px;
      color: #666;
      text-transform: uppercase;
    }

    .player-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      align-items: center;
    }

    .player-btn {
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 10px 15px;
      cursor: crosshair;
      font-size: 16px;
      transition: all 0.2s;
    }

    .player-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .player-btn.play-pause {
      font-size: 20px;
      padding: 12px 18px;
    }

    .player-progress {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'Courier New', monospace;
      font-size: 10px;
      color: #888;
    }

    .progress-slider {
      flex: 1;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
      cursor: crosshair;
    }

    .player-volume {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'Courier New', monospace;
      font-size: 10px;
      color: #888;
    }

    .volume-slider {
      width: 100px;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
      cursor: crosshair;
    }

    .audio-visualizer {
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
      text-align: center;
    }

    #audioVisualizerCanvas {
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(0, 0, 0, 0.9);
    }

    /* Composer Styles */
    .composer-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .composer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .composer-status {
      display: flex;
      gap: 15px;
      font-family: 'Courier New', monospace;
      font-size: 10px;
      color: #888;
      text-transform: uppercase;
    }

    .recording-controls {
      display: flex;
      gap: 10px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .record-btn {
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 10px 15px;
      cursor: crosshair;
      font-family: 'Courier New', monospace;
      font-size: 10px;
      text-transform: uppercase;
      transition: all 0.2s;
    }

    .record-btn:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .record-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ai-generator {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
    }

    .ai-controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }

    .ai-prompt {
      width: 100%;
      height: 80px;
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 10px;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      resize: vertical;
    }

    .ai-btn {
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 12px 20px;
      cursor: crosshair;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      text-transform: uppercase;
      font-weight: bold;
      transition: all 0.2s;
    }

    .ai-btn:hover {
      background: #ffff00;
      color: #000000;
      border-color: #ffff00;
    }

    .ai-presets {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .preset-btn {
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 6px 12px;
      cursor: crosshair;
      font-family: 'Courier New', monospace;
      font-size: 9px;
      text-transform: uppercase;
      transition: all 0.2s;
    }

    .preset-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .sequence-timeline {
      flex: 1;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
    }

    .timeline-container {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-top: 15px;
    }

    .timeline-track {
      display: flex;
      align-items: center;
      min-height: 40px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .track-label {
      width: 100px;
      padding: 10px;
      font-family: 'Courier New', monospace;
      font-size: 9px;
      color: #888;
      text-transform: uppercase;
      border-right: 1px solid rgba(255, 255, 255, 0.2);
    }

    .track-content {
      flex: 1;
      padding: 5px;
      min-height: 30px;
    }

    .sequence-library {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
    }

    /* Left Column - Dual Layer Palettes */
    .layers-column {
      flex: 0 0 300px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    /* Crossfader Section */
    .crossfader-section {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 15px;
    }

    .crossfader-header {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .crossfader-label {
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 16px;
      color: #ffffff;
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
      min-width: 20px;
      text-align: center;
    }

    .crossfader-container {
      flex: 1;
      position: relative;
      height: 40px;
      display: flex;
      align-items: center;
    }

    .crossfader {
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
      -webkit-appearance: none;
      cursor: crosshair;
      border: 1px solid rgba(255, 255, 255, 0.3);
      position: relative;
      z-index: 2;
    }

    .crossfader::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 30px;
      background: #ffffff;
      cursor: crosshair;
      border: 2px solid #000000;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
    }

    .crossfader::-webkit-slider-thumb:hover {
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.8);
    }

    .crossfader-track {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(to right, #ffffff 0%, rgba(255,255,255,0.3) 50%, #ffffff 100%);
      transform: translateY(-50%);
      z-index: 1;
    }

    /* Palette Sections */
    .palette-section {
      flex: 1;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px;
      display: flex;
      flex-direction: column;
      min-height: 200px;
    }

    .palette-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .palette-header h3 {
      margin: 0;
      font-size: 12px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #ffffff;
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
    }

    .add-layer-btn {
      background: #ffffff;
      color: #000000;
      border: 1px solid #ffffff;
      padding: 6px 12px;
      cursor: crosshair;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.2s;
    }

    .add-layer-btn:hover {
      background: #000000;
      color: #ffffff;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }

    .layers-list {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .layer-item {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 12px;
      cursor: crosshair;
      transition: all 0.2s;
      user-select: none;
    }

    .layer-item:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .layer-item.selected {
      background: rgba(255, 255, 255, 0.1);
      border-color: #ffffff;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }

    .layer-item.dragging {
      opacity: 0.5;
      transform: rotate(2deg);
      z-index: 1000;
    }

    .layer-item.drag-over {
      border-color: #ffffff;
      border-style: dashed;
      background: rgba(255, 255, 255, 0.15);
    }

    .drag-handle {
      display: inline-block;
      margin-right: 8px;
      color: #888;
      cursor: crosshair;
      font-size: 12px;
      font-family: 'Courier New', monospace;
    }

    .layer-name {
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 12px;
      font-family: 'Courier New', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .layer-buttons {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .layer-btn {
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 4px 8px;
      cursor: crosshair;
      font-size: 10px;
      font-family: 'Courier New', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.2s;
      min-width: 24px;
      text-align: center;
    }

    .layer-btn:hover {
      background: #ffffff;
      color: #000000;
      border-color: #ffffff;
    }

    .layer-btn.active {
      background: #ffffff;
      color: #000000;
      border-color: #ffffff;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }

    /* Middle Column - Controls */
    .controls-column {
      flex: 0 0 400px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .controls-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .controls-header h2 {
      margin: 0;
      font-size: 14px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #ffffff;
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
    }

    .selected-layer-info {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 12px;
      margin-bottom: 20px;
      text-align: center;
      color: #ffffff;
      font-size: 11px;
      font-family: 'Courier New', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .control-group {
      margin-bottom: 20px;
    }

    .control-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 11px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .control-value {
      color: #ffffff;
      font-weight: bold;
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
    }

    .control-slider {
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
      -webkit-appearance: none;
      cursor: crosshair;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .control-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: #ffffff;
      cursor: crosshair;
      transition: all 0.2s;
      border: 1px solid rgba(0, 0, 0, 0.2);
    }

    .control-slider::-webkit-slider-thumb:hover {
      background: #ffffff;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
    }

    .global-controls {
      margin-top: auto;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }

    .global-btn {
      width: 100%;
      background: rgba(0, 0, 0, 0.8);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 12px;
      cursor: crosshair;
      font-size: 12px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 10px;
      transition: all 0.2s;
    }

    .global-btn:hover {
      background: #ffffff;
      color: #000000;
      border-color: #ffffff;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }

    .global-btn.pause {
      background: rgba(255, 255, 255, 0.1);
      border-color: #ffffff;
    }

    .global-btn.pause:hover {
      background: #ffffff;
      color: #000000;
    }

    .global-btn.resume {
      background: rgba(255, 255, 255, 0.1);
      border-color: #ffffff;
    }

    .global-btn.resume:hover {
      background: #ffffff;
      color: #000000;
    }

    /* Right Column - Preview */
    .preview-column {
      flex: 1;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .preview-header h2 {
      margin: 0;
      font-size: 14px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #ffffff;
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
    }

    .preview-screen {
      flex: 1;
      background: #000000;
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 8px;
      overflow: hidden;
      min-height: 400px;
    }

    .preview-row {
      flex: 1;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      min-height: 120px;
    }

    .preview-row.output-preview {
      border: 1px solid #ffffff;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }

    .preview-row-label {
      position: absolute;
      top: 4px;
      left: 8px;
      font-size: 9px;
      color: #ffffff;
      background: rgba(0,0,0,0.9);
      padding: 2px 6px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      z-index: 10;
      font-family: 'Courier New', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .preview-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border: 1px solid rgba(255, 255, 255, 0.1);
      filter: contrast(1.1);
    }

    .preview-placeholder {
      color: #888;
      font-size: 11px;
      text-align: center;
      font-family: 'Courier New', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Inverse button styling */
    .inverse-btn {
      background: rgba(156, 39, 176, 0.8);
      color: #ffffff;
      border: 1px solid rgba(156, 39, 176, 0.6);
      padding: 4px 8px;
      cursor: crosshair;
      font-size: 10px;
      font-family: 'Courier New', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.2s;
      min-width: 24px;
      text-align: center;
    }

    .inverse-btn:hover {
      background: #9c27b0;
      border-color: #9c27b0;
      box-shadow: 0 0 8px rgba(156, 39, 176, 0.5);
    }

    .inverse-btn.active {
      background: #ffffff;
      color: #9c27b0;
      border-color: #ffffff;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }

    /* Scrollbar styling */
    .layers-list::-webkit-scrollbar {
      width: 4px;
    }

    .layers-list::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
    }

    .layers-list::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
    }

    .layers-list::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }
  </style>
</head>
<body>
  <!-- V3XV0ID Header -->
  <div class="v3xv0id-header">
    <div class="v3xv0id-brand">V3XV0ID</div>
    <div class="v3xv0id-subtitle">Image Animator Controls</div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button class="tab-button active" data-tab="layers">üéõÔ∏è LAYERS</button>
    <button class="tab-button" data-tab="patterns">üé® PATTERNS</button>
    <button class="tab-button" data-tab="music">üéµ MUSIC</button>
    <button class="tab-button" data-tab="videos">üé¨ VIDEOS</button>
    <button class="tab-button" data-tab="images">üñºÔ∏è IMAGES</button>
    <button class="tab-button" data-tab="composer">üé≠ COMPOSER</button>
  </div>
  
      <div class="main-container">
    <!-- Layers Tab Content -->
    <div class="tab-content active" id="layersTab">
      <!-- V3XV0ID Cloud Performance Section -->
      <div class="v3xv0id-performance-section" style="position: fixed; top: 70px; right: 15px; width: 300px; background: rgba(0, 0, 0, 0.95); border: 2px solid rgba(255, 255, 255, 0.3); padding: 15px; z-index: 998; display: none;">
        <div class="performance-header" style="margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.2);">
          <h3 style="margin: 0; font-size: 14px; font-family: 'Courier New', monospace; font-weight: bold; text-transform: uppercase; letter-spacing: 0.1em; color: #ffffff; text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);">üé≠ V3XV0ID CLOUD</h3>
          <div style="font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 0.05em; margin-top: 5px;">PERFORMANCE SYSTEM</div>
        </div>
        
        <div class="performance-status" style="margin-bottom: 15px; padding: 10px; background: rgba(0, 0, 0, 0.6); border: 1px solid rgba(255, 255, 255, 0.2);">
          <div id="cloudStatus" style="font-size: 11px; font-family: 'Courier New', monospace; color: #888; text-transform: uppercase;">üåê CONNECTING...</div>
          <div id="performanceStatus" style="font-size: 11px; font-family: 'Courier New', monospace; color: #888; text-transform: uppercase; margin-top: 5px;">‚èπÔ∏è READY</div>
        </div>
        
        <div class="performance-controls" style="display: flex; flex-direction: column; gap: 10px;">
          <button id="initCloudBtn" class="performance-btn" style="background: #ffffff; color: #000000; border: 1px solid #ffffff; padding: 10px; cursor: crosshair; font-family: 'Courier New', monospace; font-weight: bold; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.2s;">
            üåê CONNECT TO CLOUD
          </button>
          
          <button id="startPerformanceBtn" class="performance-btn" style="background: rgba(0, 0, 0, 0.8); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.3); padding: 10px; cursor: crosshair; font-family: 'Courier New', monospace; font-weight: bold; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.2s;" disabled>
            üé≠ START PERFORMANCE
          </button>
          
          <button id="stopPerformanceBtn" class="performance-btn" style="background: rgba(0, 0, 0, 0.8); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.3); padding: 10px; cursor: crosshair; font-family: 'Courier New', monospace; font-weight: bold; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.2s;" disabled>
            üõë STOP PERFORMANCE
          </button>
        </div>
        
        <div class="performance-info" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.2);">
          <div id="currentTrack" style="font-size: 10px; font-family: 'Courier New', monospace; color: #888; text-transform: uppercase; margin-bottom: 5px;">NO TRACK</div>
          <div id="performanceProgress" style="width: 100%; height: 4px; background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 5px;">
            <div id="progressBar" style="height: 100%; background: #ffffff; width: 0%; transition: width 0.1s;"></div>
          </div>
          <div id="performanceTime" style="font-size: 10px; font-family: 'Courier New', monospace; color: #888; text-transform: uppercase;">00:00 / 00:00</div>
        </div>
        
        <button id="togglePerformancePanel" style="position: absolute; top: -15px; right: -15px; width: 30px; height: 30px; background: rgba(0, 0, 0, 0.95); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.3); cursor: crosshair; font-family: 'Courier New', monospace; font-size: 12px;">‚úï</button>
      </div>
      
      <!-- V3XV0ID Cloud Toggle Button -->
      <button id="showPerformanceBtn" style="position: fixed; top: 80px; right: 15px; background: rgba(0, 0, 0, 0.95); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.3); padding: 8px 12px; cursor: crosshair; font-family: 'Courier New', monospace; font-weight: bold; font-size: 10px; text-transform: uppercase; letter-spacing: 0.05em; z-index: 997; transition: all 0.2s;">
        üé≠ V3XV0ID
      </button>

      <!-- Left Column - Dual Layer Palettes -->
      <div class="layers-column">
      <!-- Top Palette (A) -->
      <div class="palette-section">
        <div class="palette-header">
          <h3>PALETTE A</h3>
          <button class="add-layer-btn" id="addLayerABtn">+ ADD</button>
        </div>
        <div class="layers-list" id="layersListA">
          <!-- Palette A layers will be populated here -->
        </div>
      </div>
      
      <!-- Crossfader Section - Between Palettes -->
      <div class="crossfader-section">
        <div class="crossfader-header">
          <span class="crossfader-label">A</span>
          <div class="crossfader-container">
            <input type="range" class="crossfader" id="crossfader" min="0" max="100" value="0">
            <div class="crossfader-track"></div>
          </div>
          <span class="crossfader-label">B</span>
        </div>
      </div>
      
      <!-- Bottom Palette (B) -->
      <div class="palette-section">
        <div class="palette-header">
          <h3>PALETTE B</h3>
          <button class="add-layer-btn" id="addLayerBBtn">+ ADD</button>
        </div>
        <div class="layers-list" id="layersListB">
          <!-- Palette B layers will be populated here -->
        </div>
      </div>
    </div>

    <!-- Middle Column - Controls -->
    <div class="controls-column">
      <div class="controls-header">
        <h2>CONTROLS</h2>
      </div>
      
      <div class="selected-layer-info" id="selectedLayerInfo">
        No layer selected
      </div>

      <div class="control-group">
        <div class="control-label">
          <span>Speed</span>
          <span class="control-value" id="speedValue">100 ms</span>
        </div>
        <input type="range" class="control-slider" id="speedControl" min="1" max="100" value="20">
      </div>

      <div class="control-group">
        <div class="control-label">
          <span>Size</span>
          <span class="control-value" id="sizeValue">100%</span>
        </div>
        <input type="range" class="control-slider" id="sizeControl" min="10" max="300" value="100">
      </div>

      <div class="control-group">
        <div class="control-label">
          <span>Jitter</span>
          <span class="control-value" id="jitterValue">0px</span>
        </div>
        <input type="range" class="control-slider" id="jitterControl" min="0" max="100" value="0">
      </div>

      <div class="control-group">
        <div class="control-label">
          <span>Opacity</span>
          <span class="control-value" id="opacityValue">100%</span>
        </div>
        <input type="range" class="control-slider" id="opacityControl" min="0" max="100" value="100">
      </div>

      <div class="control-group">
        <div class="control-label">
          <span>Strobe</span>
          <span class="control-value" id="strobeValue">0 Hz</span>
        </div>
        <input type="range" class="control-slider" id="strobeControl" min="0" max="20" value="0">
      </div>

      <div class="control-group">
        <div class="control-label">
          <span>Impact</span>
          <span class="control-value" id="impactValue">0 Hz</span>
        </div>
        <input type="range" class="control-slider" id="impactControl" min="0" max="20" value="0">
      </div>

      <div class="global-controls">
        <button class="global-btn resume" id="playPauseBtn">‚è∏Ô∏è PAUSE ALL</button>
        <button class="global-btn" id="setBackgroundBtn">üñºÔ∏è SET DEFAULT BACKGROUND</button>
      </div>
    </div>

    <!-- Right Column - Preview -->
    <div class="preview-column">
      <div class="preview-header">
        <h2>PREVIEW</h2>
      </div>
      <div class="preview-screen" id="previewScreen">
        <div class="preview-row output-preview" id="outputPreview">
          <div class="preview-row-label">OUTPUT WINDOW</div>
          <div class="preview-placeholder">NO OUTPUT CONTENT</div>
        </div>
        <div class="preview-row" id="preview2">
          <div class="preview-row-label">PALETTE A</div>
          <div class="preview-placeholder">NO CONTENT</div>
        </div>
        <div class="preview-row" id="preview3">
          <div class="preview-row-label">PALETTE B</div>
          <div class="preview-placeholder">NO CONTENT</div>
        </div>
      </div>
    </div>
    </div>

    <!-- Patterns Tab Content -->
    <div class="tab-content" id="patternsTab">
      <div class="patterns-container">
        <!-- Pattern Generator Header -->
        <div class="patterns-header">
          <h2 class="cyber-text">üé® PATTERN GENERATOR</h2>
          <div class="pattern-status">
            <span id="patternStatus">READY</span>
            <span id="patternFPS">0 FPS</span>
          </div>
        </div>

        <!-- Pattern Studio -->
        <div class="pattern-studio">
          <!-- Code Editor -->
          <div class="pattern-editor">
            <div class="editor-header">
              <h3>CODE EDITOR</h3>
              <div class="editor-controls">
                <button id="runPatternBtn" class="pattern-btn run">‚ñ∂Ô∏è RUN</button>
                <button id="stopPatternBtn" class="pattern-btn stop">‚èπÔ∏è STOP</button>
                <button id="exportPatternBtn" class="pattern-btn export">üíæ EXPORT</button>
              </div>
            </div>
            <textarea id="patternCodeEditor" class="code-editor" placeholder="// Write your P5.js pattern code here...
function setup() {
  createCanvas(400, 400);
}

function draw() {
  background(0);
  fill(255);
  ellipse(mouseX, mouseY, 50, 50);
}"></textarea>
          </div>

          <!-- Preview Canvas -->
          <div class="pattern-preview">
            <div class="preview-header">
              <h3>LIVE PREVIEW</h3>
            </div>
            <div id="patternPreviewContainer" class="preview-container">
              <!-- P5.js canvas will be inserted here -->
            </div>
          </div>
        </div>

        <!-- Pattern Library -->
        <div class="pattern-library">
          <h3>PATTERN LIBRARY</h3>
          <div class="pattern-presets" id="patternPresets">
            <!-- Pattern presets will be populated here -->
          </div>
        </div>

        <!-- Target Layers -->
        <div class="pattern-targets">
          <h3>TARGET LAYERS</h3>
          <div class="target-layers-list" id="targetLayersList">
            <!-- Target layers will be populated here -->
          </div>
          <div class="target-info">
            <span id="activeTargetsCount">0</span> layers selected
          </div>
        </div>
      </div>
    </div>

    <!-- Music Tab Content -->
    <div class="tab-content" id="musicTab">
      <div class="music-player-container">
        <!-- Music Player Header -->
        <div class="music-player-header">
          <h2 class="cyber-text">üéµ MUSIC PLAYER</h2>
          <div class="cloud-status" id="musicCloudStatus">üåê CONNECTING...</div>
          <div class="music-controls">
            <button id="loadLocalMusicBtn" class="browser-btn">üìÅ LOAD LOCAL</button>
            <button id="refreshMusicBtn" class="browser-btn">üîÑ REFRESH</button>
            <input type="text" id="musicSearch" class="search-input" placeholder="SEARCH MUSIC...">
          </div>
        </div>

        <!-- Music Library -->
        <div class="music-library-section">
          <div class="music-library" id="musicLibrary">
            <!-- Music tracks will be populated here -->
          </div>
        </div>

        <!-- Audio Player -->
        <div class="audio-player">
          <div class="player-info">
            <div class="track-artwork">
              <div class="artwork-placeholder">üéµ</div>
            </div>
            <div class="track-details">
              <div class="track-title" id="currentTrackTitle">NO TRACK</div>
              <div class="track-artist" id="currentTrackArtist">UNKNOWN ARTIST</div>
              <div class="track-format" id="trackFormat">---</div>
            </div>
          </div>

          <div class="player-controls">
            <button id="prevTrackBtn" class="player-btn">‚èÆÔ∏è</button>
            <button id="playPauseTrackBtn" class="player-btn play-pause">‚ñ∂Ô∏è</button>
            <button id="nextTrackBtn" class="player-btn">‚è≠Ô∏è</button>
            <button id="shuffleBtn" class="player-btn toggle">üîÄ</button>
            <button id="repeatBtn" class="player-btn toggle">üîÅ</button>
          </div>

          <div class="player-progress">
            <span id="currentTime">00:00</span>
            <input type="range" id="progressSlider" class="progress-slider" min="0" max="100" value="0">
            <span id="totalTime">00:00</span>
          </div>

          <div class="player-volume">
            <span>üîä</span>
            <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="50">
            <span id="volumeValue">50%</span>
          </div>

          <div class="player-status">
            <span id="playerStatus">READY</span>
          </div>
        </div>

        <!-- Audio Visualizer -->
        <div class="audio-visualizer">
          <canvas id="audioVisualizerCanvas" width="400" height="100"></canvas>
        </div>
      </div>
    </div>

    <!-- Videos Tab Content -->
    <div class="tab-content" id="videosTab">
      <div class="video-browser-container">
        <!-- Video Browser Header -->
        <div class="video-browser-header">
          <h2 class="cyber-text">üé¨ VIDEO BROWSER</h2>
          <div class="cloud-status" id="videoCloudStatus">üåê CONNECTING...</div>
          <div class="video-browser-controls">
            <button id="loadLocalVideosBtn" class="browser-btn">üìÅ LOAD LOCAL</button>
            <button id="refreshVideosBtn" class="browser-btn">üîÑ REFRESH</button>
            <input type="text" id="videoSearch" class="search-input" placeholder="SEARCH VIDEOS...">
          </div>
        </div>

        <!-- Video Library -->
        <div class="video-library">
          <div class="video-grid" id="videoGrid">
            <!-- Videos will be populated here -->
          </div>
        </div>

        <!-- Video Preview Panel -->
        <div class="video-preview-panel" id="videoPreviewPanel" style="display: none;">
          <div class="video-preview-header">
            <h3 id="videoPreviewTitle">VIDEO PREVIEW</h3>
            <button id="closeVideoPreview" class="close-btn">‚úï</button>
          </div>
          <div class="video-preview-content">
            <video id="videoPreviewPlayer" controls muted loop>
              <source id="videoPreviewSource" src="" type="video/mp4">
            </video>
            <div class="video-preview-info">
              <div id="videoPreviewDetails"></div>
              <div class="video-preview-actions">
                <button id="loadToLayerBtn" class="action-btn">üì• LOAD TO LAYER</button>
                <button id="loadToBackgroundBtn" class="action-btn">üñºÔ∏è SET AS BACKGROUND</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Images Tab Content -->
    <div class="tab-content" id="imagesTab">
      <div class="image-browser-container">
        <!-- Image Browser Header -->
        <div class="image-browser-header">
          <h2 class="cyber-text">üñºÔ∏è IMAGE BROWSER</h2>
          <div class="cloud-status" id="imageCloudStatus">üåê CONNECTING...</div>
          <div class="image-browser-controls">
            <button id="loadLocalImagesBtn" class="browser-btn">üìÅ LOAD LOCAL</button>
            <button id="refreshImagesBtn" class="browser-btn">üîÑ REFRESH</button>
            <input type="text" id="imageSearch" class="search-input" placeholder="SEARCH IMAGES...">
          </div>
        </div>

        <!-- Image Library -->
        <div class="image-library">
          <div class="image-grid" id="imageGrid">
            <!-- Images will be populated here -->
          </div>
        </div>

        <!-- Image Preview Panel -->
        <div class="image-preview-panel" id="imagePreviewPanel" style="display: none;">
          <div class="image-preview-header">
            <h3 id="imagePreviewTitle">IMAGE PREVIEW</h3>
            <button id="closeImagePreview" class="close-btn">‚úï</button>
          </div>
          <div class="image-preview-content">
            <img id="imagePreviewImg" src="" alt="Preview">
            <div class="image-preview-info">
              <div id="imagePreviewDetails"></div>
              <div class="image-preview-actions">
                <button id="loadImageToLayerBtn" class="action-btn">üì• LOAD TO LAYER</button>
                <button id="loadImageToBackgroundBtn" class="action-btn">üñºÔ∏è SET AS BACKGROUND</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Composer Tab Content -->
    <div class="tab-content" id="composerTab">
      <div class="composer-container">
        <!-- Composer Header -->
        <div class="composer-header">
          <h2 class="cyber-text">üé≠ SEQUENCE COMPOSER</h2>
          <div class="composer-status">
            <span id="composerStatus">READY</span>
            <span id="recordingTime">00:00</span>
          </div>
        </div>

        <!-- Recording Controls -->
        <div class="recording-controls">
          <button id="startRecordingBtn" class="record-btn">üé¨ START RECORDING</button>
          <button id="stopRecordingBtn" class="record-btn" disabled>‚èπÔ∏è STOP RECORDING</button>
          <button id="playSequenceBtn" class="record-btn" disabled>‚ñ∂Ô∏è PLAY SEQUENCE</button>
          <button id="saveSequenceBtn" class="record-btn" disabled>üíæ SAVE SEQUENCE</button>
        </div>

        <!-- AI Sequence Generator -->
        <div class="ai-generator">
          <h3>ü§ñ AI SEQUENCE GENERATOR</h3>
          <div class="ai-controls">
            <textarea id="aiPrompt" class="ai-prompt" placeholder="Describe the VJ sequence you want to create...
Example: 'Create a psychedelic sequence with swirling patterns, neon colors, and video transitions that sync to electronic music'"></textarea>
            <button id="generateSequenceBtn" class="ai-btn">‚ú® GENERATE SEQUENCE</button>
          </div>
          <div class="ai-presets">
            <button class="preset-btn" data-preset="psychedelic">üåÄ PSYCHEDELIC</button>
            <button class="preset-btn" data-preset="minimal">‚ö´ MINIMAL</button>
            <button class="preset-btn" data-preset="glitch">üì∫ GLITCH</button>
            <button class="preset-btn" data-preset="cyberpunk">üåÉ CYBERPUNK</button>
          </div>
        </div>

        <!-- Sequence Timeline -->
        <div class="sequence-timeline">
          <h3>SEQUENCE TIMELINE</h3>
          <div class="timeline-container" id="timelineContainer">
            <div class="timeline-track" data-track="patterns">
              <div class="track-label">PATTERNS</div>
              <div class="track-content" id="patternsTrack"></div>
            </div>
            <div class="timeline-track" data-track="images">
              <div class="track-label">IMAGES</div>
              <div class="track-content" id="imagesTrack"></div>
            </div>
            <div class="timeline-track" data-track="videos">
              <div class="track-label">VIDEOS</div>
              <div class="track-content" id="videosTrack"></div>
            </div>
            <div class="timeline-track" data-track="effects">
              <div class="track-label">EFFECTS</div>
              <div class="track-content" id="effectsTrack"></div>
            </div>
          </div>
        </div>

        <!-- Sequence Library -->
        <div class="sequence-library">
          <h3>SEQUENCE LIBRARY</h3>
          <div class="sequence-list" id="sequenceList">
            <!-- Saved sequences will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', function() {
      const { ipcRenderer } = require('electron');
      const { dialog } = require('@electron/remote');
      const fs = require('fs');
      const path = require('path');
      
      // State variables
      let layersA = []; // Palette A layers
      let layersB = []; // Palette B layers
      let selectedLayer = null;
      let globalPaused = false;
      let crossfaderValue = 0; // 0 = full A, 100 = full B, start with full A
      let activePalette = 'A'; // Which palette is currently being shown
      
      // DOM elements
      const layersListA = document.getElementById('layersListA');
      const layersListB = document.getElementById('layersListB');
      const crossfader = document.getElementById('crossfader');
      const selectedLayerInfo = document.getElementById('selectedLayerInfo');
      const addLayerABtn = document.getElementById('addLayerABtn');
      const addLayerBBtn = document.getElementById('addLayerBBtn');
      const playPauseBtn = document.getElementById('playPauseBtn');
      const setBackgroundBtn = document.getElementById('setBackgroundBtn');
      const previewScreen = document.getElementById('previewScreen');
      const outputPreview = document.getElementById('outputPreview');
      const preview2 = document.getElementById('preview2');
      const preview3 = document.getElementById('preview3');
      
      // Control elements
      const speedControl = document.getElementById('speedControl');
      const sizeControl = document.getElementById('sizeControl');
      const jitterControl = document.getElementById('jitterControl');
      const opacityControl = document.getElementById('opacityControl');
      const strobeControl = document.getElementById('strobeControl');
      const impactControl = document.getElementById('impactControl');
      
      // Control value displays
      const speedValue = document.getElementById('speedValue');
      const sizeValue = document.getElementById('sizeValue');
      const jitterValue = document.getElementById('jitterValue');
      const opacityValue = document.getElementById('opacityValue');
      const strobeValue = document.getElementById('strobeValue');
      const impactValue = document.getElementById('impactValue');
      
      // Send commands to output window
      function sendToOutput(command, data = {}) {
        ipcRenderer.send('control-to-output', { command, data });
      }
      
      // Handle messages from output window
      ipcRenderer.on('output-message', (event, message) => {
        const { command, data } = message;
        
        switch (command) {
          case 'layers-updated':
            updateLayersFromOutput(data.layers);
            updateLayersList();
            updatePreview();
            break;
          case 'layer-selected':
            if (data.layer) {
              selectedLayer = data.layer;
              updateSelectedLayer();
            } else {
              selectedLayer = null;
              updateSelectedLayer();
            }
            break;
          case 'global-pause-changed':
            globalPaused = data.globalPaused;
            updatePlayPauseButton();
            break;
          case 'preview-update':
            updateOutputPreview(data);
            updatePalettePreview(data);
            break;
        }
      });
      
      function updateLayersFromOutput(outputLayers) {
        // Clear both palettes and redistribute based on actual palette assignment from output
        layersA = [];
        layersB = [];
        
        outputLayers.forEach(layer => {
          // Use the actual palette assignment from the output window
          const layerPalette = layer.palette || 'A';
          
          if (layerPalette === 'A') {
            layersA.push(layer);
          } else {
            layersB.push(layer);
          }
        });
      }
      
      function updateCrossfader() {
        crossfaderValue = parseInt(crossfader.value);
        
        // Apply crossfader logic to output window
        // 0 = full A, 100 = full B, 50 = mix
        const aOpacity = crossfaderValue <= 50 ? 1 : (100 - crossfaderValue) / 50;
        const bOpacity = crossfaderValue >= 50 ? 1 : crossfaderValue / 50;
        
        // Send crossfader values to output window
        sendToOutput('crossfader-update', { 
          aOpacity, 
          bOpacity, 
          crossfaderValue 
        });
        
        // Update which palette is considered "active" for new layers
        activePalette = crossfaderValue < 50 ? 'A' : 'B';
      }
      
      function updateLayersList() {
        updatePaletteList(layersListA, layersA, 'A');
        updatePaletteList(layersListB, layersB, 'B');
      }
      
      function updatePaletteList(paletteElement, layers, paletteName) {
        paletteElement.innerHTML = '';
        
        layers.forEach(layer => {
          const layerItem = document.createElement('div');
          layerItem.className = 'layer-item';
          if (selectedLayer && selectedLayer.id === layer.id) {
            layerItem.classList.add('selected');
          }
          
          layerItem.innerHTML = `
            <div class="layer-name">
              <span class="drag-handle" title="Drag to reorder">‚ãÆ‚ãÆ</span>
              ${layer.name}
            </div>
            <div class="layer-buttons">
              <button class="layer-btn ${layer.visible ? 'active' : ''}" onclick="toggleVisibility(${layer.id})" title="Toggle Visibility">üëÅ</button>
              <button class="layer-btn" onclick="loadImages(${layer.id})" title="Load Images">üìÅ</button>
              <button class="layer-btn" onclick="duplicateLayer(${layer.id})" title="Duplicate">‚ßâ</button>
              <button class="layer-btn" onclick="removeLayer(${layer.id})" title="Delete">‚úï</button>
              <button class="inverse-btn ${layer.inverse ? 'active' : ''}" onclick="toggleInverse(${layer.id})" title="Inverse Colors">‚ö´‚ö™</button>
            </div>
          `;
          
          // Make layer item draggable
          layerItem.draggable = true;
          layerItem.dataset.layerId = layer.id;
          layerItem.dataset.palette = paletteName;
          
          layerItem.addEventListener('click', (e) => {
            if (e.target.tagName !== 'BUTTON' && !e.target.classList.contains('drag-handle')) {
              selectLayer(layer.id);
            }
          });
          
          // Add drag and drop event listeners
          layerItem.addEventListener('dragstart', handleDragStart);
          layerItem.addEventListener('dragover', handleDragOver);
          layerItem.addEventListener('dragenter', handleDragEnter);
          layerItem.addEventListener('dragleave', handleDragLeave);
          layerItem.addEventListener('drop', handleDrop);
          layerItem.addEventListener('dragend', handleDragEnd);
          
          paletteElement.appendChild(layerItem);
        });
      }
      
      function updateSelectedLayer() {
        if (selectedLayer) {
          selectedLayerInfo.textContent = `Controlling: ${selectedLayer.name}`;
          
          // Update control values
          speedControl.value = selectedLayer.speed;
          sizeControl.value = selectedLayer.size;
          jitterControl.value = selectedLayer.jitterAmount;
          opacityControl.value = selectedLayer.opacity;
          strobeControl.value = selectedLayer.strobe;
          impactControl.value = selectedLayer.impact;
          
          // Update display values
          speedValue.textContent = sliderToMs(selectedLayer.speed) + ' ms';
          sizeValue.textContent = selectedLayer.size + '%';
          jitterValue.textContent = selectedLayer.jitterAmount + 'px';
          opacityValue.textContent = selectedLayer.opacity + '%';
          strobeValue.textContent = selectedLayer.strobe + ' Hz';
          impactValue.textContent = selectedLayer.impact + ' Hz';
          
          // Enable controls
          [speedControl, sizeControl, jitterControl, opacityControl, strobeControl, impactControl].forEach(control => {
            control.disabled = false;
          });
        } else {
          selectedLayerInfo.textContent = 'No layer selected';
          
          // Disable controls
          [speedControl, sizeControl, jitterControl, opacityControl, strobeControl, impactControl].forEach(control => {
            control.disabled = true;
          });
        }
        
        updateLayersList();
      }
      
      function updatePlayPauseButton() {
        if (globalPaused) {
          playPauseBtn.textContent = '‚ñ∂Ô∏è Resume All';
          playPauseBtn.className = 'global-btn resume';
        } else {
          playPauseBtn.textContent = '‚è∏Ô∏è Pause All';
          playPauseBtn.className = 'global-btn pause';
        }
      }
      
      function updatePreview() {
        // Preview 2 shows Palette A (topmost visible layer)
        const visibleLayersA = layersA.filter(l => l.visible);
        const topLayerA = visibleLayersA.length > 0 ? 
          visibleLayersA.reduce((top, layer) => {
            return layer.id > top.id ? layer : top; // Get highest ID (most recent)
          }) : null;
        updatePreviewRow(preview2, topLayerA);
        
        // Preview 3 shows Palette B (topmost visible layer)
        const visibleLayersB = layersB.filter(l => l.visible);
        const topLayerB = visibleLayersB.length > 0 ? 
          visibleLayersB.reduce((top, layer) => {
            return layer.id > top.id ? layer : top; // Get highest ID (most recent)
          }) : null;
        updatePreviewRow(preview3, topLayerB);
      }
      
      function updatePalettePreview(data) {
        // Update Palette A preview with live data
        if (data.paletteA) {
          updatePreviewWithData(preview2, data.paletteA);
        } else {
          // Clear Palette A preview
          const label = preview2.querySelector('.preview-row-label');
          preview2.innerHTML = '';
          preview2.appendChild(label);
          const placeholder = document.createElement('div');
          placeholder.className = 'preview-placeholder';
          placeholder.textContent = 'NO CONTENT';
          preview2.appendChild(placeholder);
        }
        
        // Update Palette B preview with live data
        if (data.paletteB) {
          updatePreviewWithData(preview3, data.paletteB);
        } else {
          // Clear Palette B preview
          const label = preview3.querySelector('.preview-row-label');
          preview3.innerHTML = '';
          preview3.appendChild(label);
          const placeholder = document.createElement('div');
          placeholder.className = 'preview-placeholder';
          placeholder.textContent = 'NO CONTENT';
          preview3.appendChild(placeholder);
        }
      }
      
      function updatePreviewWithData(previewElement, data) {
        const label = previewElement.querySelector('.preview-row-label');
        previewElement.innerHTML = '';
        previewElement.appendChild(label);
        
        if (data.imageSrc) {
          // Determine if it's a video or image
          const isVideo = data.imageSrc && (
            data.imageSrc.includes('.mp4') || 
            data.imageSrc.includes('.mov') || 
            data.imageSrc.includes('.avi') || 
            data.imageSrc.includes('.webm') || 
            data.imageSrc.includes('.mkv')
          );
          
          if (isVideo) {
            const previewVideo = document.createElement('video');
            previewVideo.className = 'preview-image';
            previewVideo.src = data.imageSrc;
            previewVideo.autoplay = true;
            previewVideo.loop = true;
            previewVideo.muted = true;
            previewVideo.playsInline = true;
            previewVideo.style.cssText = `
              max-width: 100%;
              max-height: 100%;
              object-fit: contain;
              opacity: ${data.opacity || 1};
              transform: scale(${Math.min(data.scale || 1, 0.9)});
            `;
            
            if (data.inverse) {
              previewVideo.style.filter = 'invert(1)';
            }
            
            // Ensure video starts playing
            previewVideo.addEventListener('loadeddata', () => {
              previewVideo.play().catch(e => console.log('Preview video autoplay prevented:', e));
            });
            
            previewVideo.onerror = () => {
              previewElement.innerHTML = '<div class="preview-placeholder">VIDEO NOT FOUND</div>';
              previewElement.appendChild(label);
            };
            
            previewElement.appendChild(previewVideo);
          } else {
            const previewImg = document.createElement('img');
            previewImg.className = 'preview-image';
            previewImg.src = data.imageSrc;
            previewImg.style.cssText = `
              max-width: 100%;
              max-height: 100%;
              object-fit: contain;
              opacity: ${data.opacity || 1};
              transform: scale(${Math.min(data.scale || 1, 0.9)});
            `;
            
            if (data.inverse) {
              previewImg.style.filter = 'invert(1)';
            }
            
            previewImg.onerror = () => {
              previewElement.innerHTML = '<div class="preview-placeholder">IMAGE NOT FOUND</div>';
              previewElement.appendChild(label);
            };
            
            previewElement.appendChild(previewImg);
          }
        }
      }
      
      function updateOutputPreview(data) {
        // Update the output preview row with data from the output window
        const label = outputPreview.querySelector('.preview-row-label');
        
        // Clear previous content but keep the label
        outputPreview.innerHTML = '';
        outputPreview.appendChild(label);
        
        if (data.imageSrc) {
          // Determine if it's a video or image
          const isVideo = data.imageSrc && (
            data.imageSrc.includes('.mp4') || 
            data.imageSrc.includes('.mov') || 
            data.imageSrc.includes('.avi') || 
            data.imageSrc.includes('.webm') || 
            data.imageSrc.includes('.mkv')
          );
          
          if (isVideo) {
            const previewVideo = document.createElement('video');
            previewVideo.className = 'preview-image';
            previewVideo.src = data.imageSrc;
            previewVideo.autoplay = true;
            previewVideo.loop = true;
            previewVideo.muted = true;
            previewVideo.playsInline = true;
            previewVideo.style.cssText = `
              max-width: 100%;
              max-height: 100%;
              object-fit: contain;
              opacity: ${data.opacity || 1};
              transform: scale(${Math.min(data.scale || 1, 0.9)});
            `;
            
            if (data.inverse) {
              previewVideo.style.filter = 'invert(1)';
            }
            
            // Ensure video starts playing
            previewVideo.addEventListener('loadeddata', () => {
              previewVideo.play().catch(e => console.log('Output preview video autoplay prevented:', e));
            });
            
            previewVideo.onerror = () => {
              outputPreview.innerHTML = '<div class="preview-placeholder">VIDEO NOT FOUND</div>';
              outputPreview.appendChild(label);
            };
            
            outputPreview.appendChild(previewVideo);
          } else {
            const previewImg = document.createElement('img');
            previewImg.className = 'preview-image';
            previewImg.src = data.imageSrc;
            previewImg.style.cssText = `
              max-width: 100%;
              max-height: 100%;
              object-fit: contain;
              opacity: ${data.opacity || 1};
              transform: scale(${Math.min(data.scale || 1, 0.9)});
            `;
            
            if (data.inverse) {
              previewImg.style.filter = 'invert(1)';
            }
            
            previewImg.onerror = () => {
              outputPreview.innerHTML = '<div class="preview-placeholder">IMAGE NOT FOUND</div>';
              outputPreview.appendChild(label);
            };
            
            outputPreview.appendChild(previewImg);
          }
        } else if (data.hasDefaultBackground) {
          const previewImg = document.createElement('img');
          previewImg.className = 'preview-image';
          previewImg.src = '../vexvoid.png';
          previewImg.style.cssText = `
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
          `;
          
          if (data.defaultBackgroundInverse) {
            previewImg.style.filter = 'invert(1)';
          }
          
          outputPreview.appendChild(previewImg);
        } else {
          const placeholder = document.createElement('div');
          placeholder.className = 'preview-placeholder';
          placeholder.textContent = 'NO OUTPUT CONTENT';
          outputPreview.appendChild(placeholder);
        }
        
        // Update individual layer previews
        if (data.layers && data.layers.length > 0) {
          updatePreviewRow(preview2, data.layers[1]); // Second layer
          updatePreviewRow(preview3, data.layers[2]); // Third layer
        }
      }
      
      function updatePreviewRow(previewRow, layer) {
        const label = previewRow.querySelector('.preview-row-label');
        
        // Clear previous content but keep the label
        previewRow.innerHTML = '';
        previewRow.appendChild(label);
        
        if (layer && layer.visible && layer.imageSrc) {
          // Determine if it's a video or image
          const isVideo = layer.imageSrc && (
            layer.imageSrc.includes('.mp4') || 
            layer.imageSrc.includes('.mov') || 
            layer.imageSrc.includes('.avi') || 
            layer.imageSrc.includes('.webm') || 
            layer.imageSrc.includes('.mkv')
          );
          
          if (isVideo) {
            const previewVideo = document.createElement('video');
            previewVideo.className = 'preview-image';
            previewVideo.src = layer.imageSrc;
            previewVideo.autoplay = true;
            previewVideo.loop = true;
            previewVideo.muted = true;
            previewVideo.playsInline = true;
            previewVideo.style.cssText = `
              max-width: 100%;
              max-height: 100%;
              object-fit: contain;
              opacity: ${layer.opacity || 1};
              transform: scale(${Math.min(layer.scale || 1, 0.9)});
            `;
            
            // Apply inverse filter if enabled
            if (layer.inverse) {
              previewVideo.style.filter = 'invert(1)';
            }
            
            // Ensure video starts playing
            previewVideo.addEventListener('loadeddata', () => {
              previewVideo.play().catch(e => console.log('Layer preview video autoplay prevented:', e));
            });
            
            previewVideo.onerror = () => {
              const placeholder = document.createElement('div');
              placeholder.className = 'preview-placeholder';
              placeholder.textContent = `${layer.name} - VIDEO ERROR`;
              previewRow.innerHTML = '';
              previewRow.appendChild(label);
              previewRow.appendChild(placeholder);
            };
            
            previewRow.appendChild(previewVideo);
          } else {
            const previewImg = document.createElement('img');
            previewImg.className = 'preview-image';
            previewImg.src = layer.imageSrc;
            previewImg.style.cssText = `
              max-width: 100%;
              max-height: 100%;
              object-fit: contain;
              opacity: ${layer.opacity || 1};
              transform: scale(${Math.min(layer.scale || 1, 0.9)});
            `;
            
            // Apply inverse filter if enabled
            if (layer.inverse) {
              previewImg.style.filter = 'invert(1)';
            }
            
            previewImg.onerror = () => {
              const placeholder = document.createElement('div');
              placeholder.className = 'preview-placeholder';
              placeholder.textContent = `${layer.name} - IMAGE ERROR`;
              previewRow.innerHTML = '';
              previewRow.appendChild(label);
              previewRow.appendChild(placeholder);
            };
            
            previewRow.appendChild(previewImg);
          }
        } else {
          const placeholder = document.createElement('div');
          placeholder.className = 'preview-placeholder';
          placeholder.textContent = layer ? `${layer.name} (hidden)` : 'NO LAYER';
          previewRow.appendChild(placeholder);
        }
      }
      
      function sliderToMs(x) {
        x = Number(x);
        if (x <= 50) {
          return Math.round((x / 50) * 250);
        } else {
          return Math.round(250 + Math.pow((x - 50) / 50, 2) * (20000 - 250));
        }
      }
      
      // Global functions for button clicks
      window.selectLayer = function(layerId) {
        sendToOutput('select-layer', { layerId });
      };
      
      window.toggleVisibility = function(layerId) {
        sendToOutput('toggle-visibility', { layerId });
      };
      
      window.loadImages = async function(layerId) {
        const result = await dialog.showOpenDialog({
          properties: ['openFile', 'openDirectory', 'multiSelections'],
          filters: [
            { name: 'Media Files', extensions: ['jpg', 'jpeg', 'png', 'gif', 'mp4', 'mov', 'avi', 'webm', 'mkv'] },
            { name: 'Images', extensions: ['jpg', 'jpeg', 'png', 'gif'] },
            { name: 'Videos', extensions: ['mp4', 'mov', 'avi', 'webm', 'mkv'] },
            { name: 'All Files', extensions: ['*'] }
          ]
        });
        
        if (!result.canceled && result.filePaths.length > 0) {
          sendToOutput('load-images', { layerId, filePaths: result.filePaths });
        }
      };
      
      window.duplicateLayer = function(layerId) {
        sendToOutput('duplicate-layer', { layerId });
      };
      
      window.removeLayer = function(layerId) {
        sendToOutput('remove-layer', { layerId });
      };
      
      window.toggleInverse = function(layerId) {
        sendToOutput('toggle-inverse', { layerId });
      };
      
      // Drag and drop functionality for layer reordering
      let draggedElement = null;
      let draggedLayerId = null;
      
      function handleDragStart(e) {
        draggedElement = e.target;
        draggedLayerId = parseInt(e.target.dataset.layerId);
        e.target.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', e.target.outerHTML);
      }
      
      function handleDragOver(e) {
        if (e.preventDefault) {
          e.preventDefault();
        }
        e.dataTransfer.dropEffect = 'move';
        return false;
      }
      
      function handleDragEnter(e) {
        if (e.target !== draggedElement) {
          e.target.classList.add('drag-over');
        }
      }
      
      function handleDragLeave(e) {
        e.target.classList.remove('drag-over');
      }
      
      function handleDrop(e) {
        if (e.stopPropagation) {
          e.stopPropagation();
        }
        
        if (draggedElement !== e.target) {
          const targetLayerId = parseInt(e.target.dataset.layerId);
          if (targetLayerId && draggedLayerId && targetLayerId !== draggedLayerId) {
            reorderLayers(draggedLayerId, targetLayerId);
          }
        }
        
        e.target.classList.remove('drag-over');
        return false;
      }
      
      function handleDragEnd(e) {
        e.target.classList.remove('dragging');
        // Clean up any remaining drag-over classes
        document.querySelectorAll('.drag-over').forEach(el => {
          el.classList.remove('drag-over');
        });
        draggedElement = null;
        draggedLayerId = null;
      }
      
      function reorderLayers(draggedId, targetId) {
        // Find which palette the layers are in
        const allLayers = [...layersA, ...layersB];
        const draggedIndex = allLayers.findIndex(l => l.id === draggedId);
        const targetIndex = allLayers.findIndex(l => l.id === targetId);
        
        if (draggedIndex === -1 || targetIndex === -1) return;
        
        // Determine which palettes the layers belong to
        const draggedPalette = layersA.find(l => l.id === draggedId) ? 'A' : 'B';
        const targetPalette = layersA.find(l => l.id === targetId) ? 'A' : 'B';
        
        // If layers are in different palettes, don't allow reordering
        if (draggedPalette !== targetPalette) return;
        
        // Work with the appropriate palette
        const palette = draggedPalette === 'A' ? layersA : layersB;
        const draggedPaletteIndex = palette.findIndex(l => l.id === draggedId);
        const targetPaletteIndex = palette.findIndex(l => l.id === targetId);
        
        // Remove the dragged layer and insert it at the target position
        const [draggedLayer] = palette.splice(draggedPaletteIndex, 1);
        palette.splice(targetPaletteIndex, 0, draggedLayer);
        
        // Renumber layers based on new order (skip main layer)
        let layerNumber = 1;
        palette.forEach(layer => {
          if (!layer.isMainLayer) {
            // Extract content name, handling different naming patterns
            let contentName = layer.name;
            if (contentName.startsWith('Layer ')) {
              contentName = contentName.replace(/^Layer \d+: /, '');
            }
            // If no content name remains, it was just "Layer X"
            if (contentName === layer.name && /^Layer \d+$/.test(contentName)) {
              contentName = '';
            }
            
            // Set new name
            if (contentName) {
              layer.name = `Layer ${layerNumber}: ${contentName}`;
            } else {
              layer.name = `Layer ${layerNumber}`;
            }
            layerNumber++;
          }
        });
        
        // Send reorder command to output window
        const allLayersOrdered = [...layersA, ...layersB];
        sendToOutput('reorder-layers', { layers: allLayersOrdered.map(l => l.id) });
        
        // Update the UI
        updateLayersList();
        updatePreview();
      }
      
      window.setDefaultBackground = async function() {
        const result = await dialog.showOpenDialog({
          properties: ['openFile'],
          filters: [
            { name: 'Media Files', extensions: ['jpg', 'jpeg', 'png', 'gif', 'mp4', 'mov', 'avi', 'webm', 'mkv'] },
            { name: 'Images', extensions: ['jpg', 'jpeg', 'png', 'gif'] },
            { name: 'Videos', extensions: ['mp4', 'mov', 'avi', 'webm', 'mkv'] },
            { name: 'All Files', extensions: ['*'] }
          ]
        });
        
        if (!result.canceled && result.filePaths.length > 0) {
          sendToOutput('set-default-background', { imagePath: result.filePaths[0] });
        }
      };
      
      // Event listeners
      addLayerABtn.addEventListener('click', () => {
        activePalette = 'A';
        sendToOutput('add-layer', { palette: 'A' });
      });
      
      addLayerBBtn.addEventListener('click', () => {
        activePalette = 'B';
        sendToOutput('add-layer', { palette: 'B' });
      });
      
      crossfader.addEventListener('input', () => {
        updateCrossfader();
      });
      
      playPauseBtn.addEventListener('click', () => {
        sendToOutput('toggle-global-pause');
      });
      
      setBackgroundBtn.addEventListener('click', () => {
        setDefaultBackground();
      });
      
      // Control event listeners
      speedControl.addEventListener('input', () => {
        if (selectedLayer) {
          const value = parseInt(speedControl.value);
          speedValue.textContent = sliderToMs(value) + ' ms';
          sendToOutput('update-layer-property', { 
            layerId: selectedLayer.id, 
            property: 'speed', 
            value: value 
          });
        }
      });
      
      sizeControl.addEventListener('input', () => {
        if (selectedLayer) {
          const value = parseInt(sizeControl.value);
          sizeValue.textContent = value + '%';
          sendToOutput('update-layer-property', { 
            layerId: selectedLayer.id, 
            property: 'size', 
            value: value 
          });
        }
      });
      
      jitterControl.addEventListener('input', () => {
        if (selectedLayer) {
          const value = parseInt(jitterControl.value);
          jitterValue.textContent = value + 'px';
          sendToOutput('update-layer-property', { 
            layerId: selectedLayer.id, 
            property: 'jitterAmount', 
            value: value 
          });
        }
      });
      
      opacityControl.addEventListener('input', () => {
        if (selectedLayer) {
          const value = parseInt(opacityControl.value);
          opacityValue.textContent = value + '%';
          sendToOutput('update-layer-property', { 
            layerId: selectedLayer.id, 
            property: 'opacity', 
            value: value 
          });
        }
      });
      
      strobeControl.addEventListener('input', () => {
        if (selectedLayer) {
          const value = parseInt(strobeControl.value);
          strobeValue.textContent = value + ' Hz';
          sendToOutput('update-layer-property', { 
            layerId: selectedLayer.id, 
            property: 'strobe', 
            value: value 
          });
        }
      });
      
      impactControl.addEventListener('input', () => {
        if (selectedLayer) {
          const value = parseInt(impactControl.value);
          impactValue.textContent = value + ' Hz';
          sendToOutput('update-layer-property', { 
            layerId: selectedLayer.id, 
            property: 'impact', 
            value: value 
          });
        }
      });
      
      // Initialize crossfader to show Palette A by default
      updateCrossfader();
      
      // Request initial state from output window
      setTimeout(() => {
        sendToOutput('request-initial-state');
      }, 100);

      // ========== V3XV0ID PERFORMANCE SYSTEM ==========
      let performanceSequencer = null;
      let performanceActive = false;
      
      // V3XV0ID Performance DOM elements
      const showPerformanceBtn = document.getElementById('showPerformanceBtn');
      const performancePanel = document.querySelector('.v3xv0id-performance-section');
      const togglePerformancePanel = document.getElementById('togglePerformancePanel');
      const initCloudBtn = document.getElementById('initCloudBtn');
      const startPerformanceBtn = document.getElementById('startPerformanceBtn');
      const stopPerformanceBtn = document.getElementById('stopPerformanceBtn');
      const cloudStatus = document.getElementById('cloudStatus');
      const performanceStatus = document.getElementById('performanceStatus');
      const currentTrack = document.getElementById('currentTrack');
      const progressBar = document.getElementById('progressBar');
      const performanceTime = document.getElementById('performanceTime');
      
      // Show/hide performance panel
      showPerformanceBtn.addEventListener('click', () => {
        performancePanel.style.display = 'block';
        showPerformanceBtn.style.display = 'none';
      });
      
      togglePerformancePanel.addEventListener('click', () => {
        performancePanel.style.display = 'none';
        showPerformanceBtn.style.display = 'block';
      });
      
      // Initialize V3XV0ID Cloud Performance
      initCloudBtn.addEventListener('click', async () => {
        try {
          cloudStatus.textContent = 'üåê CONNECTING...';
          initCloudBtn.disabled = true;
          
          // Import the performance sequencer
          const V3XV0IDPerformanceSequencer = require('./performance-sequencer');
          performanceSequencer = new V3XV0IDPerformanceSequencer();
          
          // Initialize cloud connection and download content
          const success = await performanceSequencer.initialize();
          
          if (success) {
            cloudStatus.textContent = '‚úÖ CLOUD CONNECTED';
            performanceStatus.textContent = 'üé≠ READY TO PERFORM';
            startPerformanceBtn.disabled = false;
            
            // Set up performance event callbacks
            performanceSequencer.onPerformanceEvent((event, data) => {
              handlePerformanceEvent(event, data);
            });
            
            console.log('üé≠ V3XV0ID Performance System initialized successfully');
          } else {
            throw new Error('Failed to initialize performance system');
          }
          
        } catch (error) {
          console.error('‚ùå Failed to initialize V3XV0ID Performance System:', error);
          cloudStatus.textContent = '‚ùå CONNECTION FAILED';
          performanceStatus.textContent = '‚ö†Ô∏è ERROR';
          initCloudBtn.disabled = false;
        }
      });
      
      // Start V3XV0ID Performance
      startPerformanceBtn.addEventListener('click', async () => {
        if (!performanceSequencer) return;
        
        try {
          performanceStatus.textContent = 'üé≠ STARTING...';
          startPerformanceBtn.disabled = true;
          
          const success = await performanceSequencer.startPerformance();
          
          if (success) {
            performanceActive = true;
            performanceStatus.textContent = 'üé≠ PERFORMING';
            stopPerformanceBtn.disabled = false;
            
            console.log('üé≠ V3XV0ID Performance started');
          } else {
            throw new Error('Failed to start performance');
          }
          
        } catch (error) {
          console.error('‚ùå Failed to start performance:', error);
          performanceStatus.textContent = '‚ùå START FAILED';
          startPerformanceBtn.disabled = false;
        }
      });
      
      // Stop V3XV0ID Performance
      stopPerformanceBtn.addEventListener('click', () => {
        if (!performanceSequencer) return;
        
        performanceSequencer.stopPerformance();
        performanceActive = false;
        performanceStatus.textContent = '‚èπÔ∏è STOPPED';
        startPerformanceBtn.disabled = false;
        stopPerformanceBtn.disabled = true;
        
        currentTrack.textContent = 'NO TRACK';
        progressBar.style.width = '0%';
        performanceTime.textContent = '00:00 / 00:00';
        
        console.log('üõë V3XV0ID Performance stopped');
      });
      
      // Handle performance events
      function handlePerformanceEvent(event, data) {
        switch (event) {
          case 'performance-started':
            console.log('üé≠ Performance started:', data.name);
            currentTrack.textContent = data.name.toUpperCase();
            break;
            
          case 'visual-sync':
            updatePerformanceProgress(data);
            break;
            
          case 'image-change':
            loadPerformanceImage(data.imagePath);
            break;
            
          case 'video-change':
            loadPerformanceVideo(data.videoPath);
            break;
            
          case 'palette-switch':
            switchPaletteAutomatically();
            break;
        }
      }
      
      // Update performance progress UI
      function updatePerformanceProgress(data) {
        const { progress, currentTime, duration } = data;
        
        progressBar.style.width = (progress * 100) + '%';
        
        const currentMin = Math.floor(currentTime / 60);
        const currentSec = Math.floor(currentTime % 60);
        const durationMin = Math.floor(duration / 60);
        const durationSec = Math.floor(duration % 60);
        
        performanceTime.textContent = 
          `${currentMin.toString().padStart(2, '0')}:${currentSec.toString().padStart(2, '0')} / ` +
          `${durationMin.toString().padStart(2, '0')}:${durationSec.toString().padStart(2, '0')}`;
      }
      
      // Load performance content into layers
      function loadPerformanceImage(imagePath) {
        const targetPalette = activePalette;
        const layers = targetPalette === 'A' ? layersA : layersB;
        
        if (layers.length === 0) {
          sendToOutput('add-layer', { palette: targetPalette });
          setTimeout(() => {
            const newLayers = targetPalette === 'A' ? layersA : layersB;
            if (newLayers.length > 0) {
              const layerId = newLayers[newLayers.length - 1].id;
              sendToOutput('load-images', { layerId, filePaths: [imagePath] });
            }
          }, 100);
        } else {
          const layerIndex = Math.floor(Math.random() * layers.length);
          const layerId = layers[layerIndex].id;
          sendToOutput('load-images', { layerId, filePaths: [imagePath] });
        }
      }
      
      function loadPerformanceVideo(videoPath) {
        const targetPalette = activePalette === 'A' ? 'B' : 'A';
        const layers = targetPalette === 'A' ? layersA : layersB;
        
        if (layers.length === 0) {
          sendToOutput('add-layer', { palette: targetPalette });
          setTimeout(() => {
            const newLayers = targetPalette === 'A' ? layersA : layersB;
            if (newLayers.length > 0) {
              const layerId = newLayers[newLayers.length - 1].id;
              sendToOutput('load-images', { layerId, filePaths: [videoPath] });
            }
          }, 100);
        } else {
          const layerIndex = Math.floor(Math.random() * layers.length);
          const layerId = layers[layerIndex].id;
          sendToOutput('load-images', { layerId, filePaths: [videoPath] });
        }
      }
      
      // Automatically switch between palettes
      function switchPaletteAutomatically() {
        const currentValue = parseInt(crossfader.value);
        const targetValue = currentValue < 50 ? 100 : 0;
        animateCrossfader(currentValue, targetValue, 2000);
      }
      
      function animateCrossfader(fromValue, toValue, duration) {
        const startTime = Date.now();
        const valueRange = toValue - fromValue;
        
        function update() {
          const elapsed = Date.now() - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const easedProgress = 0.5 - Math.cos(progress * Math.PI) / 2;
          const currentValue = fromValue + (valueRange * easedProgress);
          
          crossfader.value = Math.round(currentValue);
          updateCrossfader();
          
          if (progress < 1) {
            requestAnimationFrame(update);
          }
        }
        
        update();
      }
      
      console.log('üé≠ V3XV0ID Performance System UI initialized');

      // ========== TAB NAVIGATION SYSTEM ==========
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      // Tab switching functionality
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          const targetTab = button.getAttribute('data-tab');
          
          // Remove active class from all buttons and content
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));
          
          // Add active class to clicked button and corresponding content
          button.classList.add('active');
          const targetContent = document.getElementById(targetTab + 'Tab');
          if (targetContent) {
            targetContent.classList.add('active');
          }
          
          console.log(`üéõÔ∏è Switched to ${targetTab.toUpperCase()} tab`);
        });
      });

      console.log('üéõÔ∏è V3XV0ID Tab Navigation System initialized');

      // ========== TAB CONTENT FUNCTIONALITY ==========

      // Videos Tab Functionality
      let videoLibrary = [];
      let selectedVideo = null;

      const videoGrid = document.getElementById('videoGrid');
      const videoSearch = document.getElementById('videoSearch');
      const loadLocalVideosBtn = document.getElementById('loadLocalVideosBtn');
      const refreshVideosBtn = document.getElementById('refreshVideosBtn');
      const videoPreviewPanel = document.getElementById('videoPreviewPanel');
      const videoPreviewPlayer = document.getElementById('videoPreviewPlayer');
      const videoPreviewSource = document.getElementById('videoPreviewSource');
      const closeVideoPreview = document.getElementById('closeVideoPreview');
      const loadToLayerBtn = document.getElementById('loadToLayerBtn');
      const loadToBackgroundBtn = document.getElementById('loadToBackgroundBtn');

      // Initialize Videos Tab
      async function initializeVideosTab() {
        try {
          console.log('üé¨ Loading V3XV0ID video library...');
          
          // Load V3XV0ID cloud manager
          const V3XV0IDCloudManager = require('./supabase-config');
          const cloudManager = new V3XV0IDCloudManager();
          
          // Initialize cloud connection
          await cloudManager.initialize();
          
          // Get video files from v3xv0id-videos bucket
          const cloudVideos = await cloudManager.getVideoFiles();
          console.log(`üìπ Found ${cloudVideos.length} videos in V3XV0ID cloud`);
          
          videoLibrary = cloudVideos.map((video, index) => ({
            id: index,
            name: video.name,
            url: cloudManager.getPublicUrl('v3xv0id-videos', video.name),
            source: 'cloud',
            format: video.name.split('.').pop().toUpperCase(),
            size: video.metadata?.size || 'Unknown',
            created: video.created_at
          }));
          
          // Update cloud status
          const statusEl = document.getElementById('videoCloudStatus');
          if (statusEl) {
            statusEl.textContent = `‚úÖ CLOUD (${cloudVideos.length} VIDEOS)`;
            statusEl.className = 'cloud-status connected';
          }
          
        } catch (error) {
          console.log('‚ö†Ô∏è Cloud videos not available, using demo mode:', error.message);
          
          // Update cloud status
          const statusEl = document.getElementById('videoCloudStatus');
          if (statusEl) {
            statusEl.textContent = 'üé≠ DEMO MODE';
            statusEl.className = 'cloud-status demo';
          }
          // Demo videos
          videoLibrary = [
            { id: 0, name: 'DEMO_ABSTRACT_01.mp4', url: null, source: 'demo', format: 'MP4' },
            { id: 1, name: 'DEMO_TUNNEL_02.mp4', url: null, source: 'demo', format: 'MP4' },
            { id: 2, name: 'DEMO_FRACTAL_03.mp4', url: null, source: 'demo', format: 'MP4' },
            { id: 3, name: 'DEMO_CYBER_04.mp4', url: null, source: 'demo', format: 'MP4' },
            { id: 4, name: 'DEMO_MATRIX_05.mp4', url: null, source: 'demo', format: 'MP4' }
          ];
        }
        
        renderVideoLibrary();
        console.log(`‚úÖ Video library loaded: ${videoLibrary.length} videos`);
      }

      function renderVideoLibrary() {
        videoGrid.innerHTML = '';
        
        const filteredVideos = videoLibrary.filter(video => 
          video.name.toLowerCase().includes(videoSearch.value.toLowerCase())
        );
        
        filteredVideos.forEach(video => {
          const videoItem = document.createElement('div');
          videoItem.className = 'video-item';
          videoItem.innerHTML = `
            <div class="video-thumbnail">üé¨</div>
            <div class="video-name">${video.name}</div>
          `;
          
          videoItem.addEventListener('click', () => {
            previewVideo(video);
          });
          
          videoGrid.appendChild(videoItem);
        });
      }

      function previewVideo(video) {
        selectedVideo = video;
        document.getElementById('videoPreviewTitle').textContent = video.name;
        document.getElementById('videoPreviewDetails').textContent = 
          `Format: ${video.format} ‚Ä¢ Source: ${video.source.toUpperCase()}`;
        
        if (video.url) {
          videoPreviewSource.src = video.url;
          videoPreviewPlayer.load();
        } else {
          videoPreviewSource.src = '';
          videoPreviewPlayer.load();
        }
        
        videoPreviewPanel.style.display = 'block';
      }

      // Images Tab Functionality
      let imageLibrary = [];
      let selectedImage = null;

      const imageGrid = document.getElementById('imageGrid');
      const imageSearch = document.getElementById('imageSearch');
      const loadLocalImagesBtn = document.getElementById('loadLocalImagesBtn');
      const refreshImagesBtn = document.getElementById('refreshImagesBtn');
      const imagePreviewPanel = document.getElementById('imagePreviewPanel');
      const imagePreviewImg = document.getElementById('imagePreviewImg');
      const closeImagePreview = document.getElementById('closeImagePreview');
      const loadImageToLayerBtn = document.getElementById('loadImageToLayerBtn');
      const loadImageToBackgroundBtn = document.getElementById('loadImageToBackgroundBtn');

      // Initialize Images Tab
      async function initializeImagesTab() {
        try {
          console.log('üñºÔ∏è Loading V3XV0ID image library...');
          
          // Load V3XV0ID cloud manager
          const V3XV0IDCloudManager = require('./supabase-config');
          const cloudManager = new V3XV0IDCloudManager();
          
          // Initialize cloud connection
          await cloudManager.initialize();
          
          // Get image files from v3xv0id-images bucket
          const cloudImages = await cloudManager.getImageSequences();
          console.log(`üé® Found ${cloudImages.length} images in V3XV0ID cloud`);
          
          imageLibrary = cloudImages.map((image, index) => ({
            id: index,
            name: image.name,
            url: cloudManager.getPublicUrl('v3xv0id-images', image.name),
            source: 'cloud',
            format: image.name.split('.').pop().toUpperCase(),
            size: image.metadata?.size || 'Unknown',
            created: image.created_at
          }));
          
          // Update cloud status
          const statusEl = document.getElementById('imageCloudStatus');
          if (statusEl) {
            statusEl.textContent = `‚úÖ CLOUD (${cloudImages.length} IMAGES)`;
            statusEl.className = 'cloud-status connected';
          }
          
        } catch (error) {
          console.log('‚ö†Ô∏è Cloud images not available, using demo mode:', error.message);
          
          // Update cloud status
          const statusEl = document.getElementById('imageCloudStatus');
          if (statusEl) {
            statusEl.textContent = 'üé≠ DEMO MODE';
            statusEl.className = 'cloud-status demo';
          }
          // Demo images
          imageLibrary = [
            { id: 0, name: 'DEMO_ABSTRACT_01.jpg', url: null, source: 'demo', format: 'JPG' },
            { id: 1, name: 'DEMO_GEOMETRIC_02.png', url: null, source: 'demo', format: 'PNG' },
            { id: 2, name: 'DEMO_FRACTAL_03.jpg', url: null, source: 'demo', format: 'JPG' },
            { id: 3, name: 'DEMO_CYBER_04.jpg', url: null, source: 'demo', format: 'JPG' },
            { id: 4, name: 'DEMO_NEON_05.png', url: null, source: 'demo', format: 'PNG' },
            { id: 5, name: 'DEMO_GLITCH_06.jpg', url: null, source: 'demo', format: 'JPG' }
          ];
        }
        
        renderImageLibrary();
        console.log(`‚úÖ Image library loaded: ${imageLibrary.length} images`);
      }

      function renderImageLibrary() {
        imageGrid.innerHTML = '';
        
        const filteredImages = imageLibrary.filter(image => 
          image.name.toLowerCase().includes(imageSearch.value.toLowerCase())
        );
        
        filteredImages.forEach(image => {
          const imageItem = document.createElement('div');
          imageItem.className = 'image-item';
          imageItem.innerHTML = `
            <div class="image-thumbnail">üñºÔ∏è</div>
            <div class="image-name">${image.name}</div>
          `;
          
          imageItem.addEventListener('click', () => {
            previewImage(image);
          });
          
          imageGrid.appendChild(imageItem);
        });
      }

      function previewImage(image) {
        selectedImage = image;
        document.getElementById('imagePreviewTitle').textContent = image.name;
        document.getElementById('imagePreviewDetails').textContent = 
          `Format: ${image.format} ‚Ä¢ Source: ${image.source.toUpperCase()}`;
        
        if (image.url) {
          imagePreviewImg.src = image.url;
        } else {
          imagePreviewImg.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5ERU1PPC90ZXh0Pjwvc3ZnPg==';
        }
        
        imagePreviewPanel.style.display = 'block';
      }

      // Patterns Tab Functionality
      let currentP5Instance = null;
      let patternRunning = false;
      let patternFPS = 0;

      const patternCodeEditor = document.getElementById('patternCodeEditor');
      const patternPreviewContainer = document.getElementById('patternPreviewContainer');
      const runPatternBtn = document.getElementById('runPatternBtn');
      const stopPatternBtn = document.getElementById('stopPatternBtn');
      const exportPatternBtn = document.getElementById('exportPatternBtn');
      const patternStatus = document.getElementById('patternStatus');
      const patternFPSDisplay = document.getElementById('patternFPS');
      const patternPresets = document.getElementById('patternPresets');
      const targetLayersList = document.getElementById('targetLayersList');
      const activeTargetsCount = document.getElementById('activeTargetsCount');

      // Pattern presets
      const patterns = {
        'Plasma Waves': `function setup() {
  createCanvas(400, 400);
  colorMode(HSB, 360, 100, 100);
}

function draw() {
  for (let x = 0; x < width; x += 4) {
    for (let y = 0; y < height; y += 4) {
      let hue = (sin(x * 0.01 + millis() * 0.002) + 
                 sin(y * 0.01 + millis() * 0.003)) * 180 + 180;
      fill(hue, 80, 90);
      noStroke();
      rect(x, y, 4, 4);
    }
  }
}`,
        'Tunnel Vision': `function setup() {
  createCanvas(400, 400);
  colorMode(HSB, 360, 100, 100);
}

function draw() {
  background(0);
  translate(width/2, height/2);
  
  for (let i = 0; i < 50; i++) {
    let size = i * 10 + sin(millis() * 0.01 + i) * 20;
    let hue = (millis() * 0.1 + i * 10) % 360;
    
    stroke(hue, 80, 90);
    strokeWeight(2);
    noFill();
    ellipse(0, 0, size, size);
  }
}`,
        'Matrix Rain': `let drops = [];

function setup() {
  createCanvas(400, 400);
  
  for (let i = 0; i < 50; i++) {
    drops.push({
      x: random(width),
      y: random(-height, 0),
      speed: random(2, 8),
      char: String.fromCharCode(random(65, 90))
    });
  }
}

function draw() {
  background(0, 20);
  fill(0, 255, 0);
  textSize(16);
  
  for (let drop of drops) {
    text(drop.char, drop.x, drop.y);
    drop.y += drop.speed;
    
    if (drop.y > height) {
      drop.y = random(-50, 0);
      drop.x = random(width);
      drop.char = String.fromCharCode(random(65, 90));
    }
  }
}`
      };

      // Initialize Patterns Tab
      function initializePatternsTab() {
        // Populate pattern presets
        patternPresets.innerHTML = '';
        Object.keys(patterns).forEach(patternName => {
          const presetBtn = document.createElement('button');
          presetBtn.className = 'preset-btn';
          presetBtn.textContent = patternName;
          presetBtn.addEventListener('click', () => {
            patternCodeEditor.value = patterns[patternName];
          });
          patternPresets.appendChild(presetBtn);
        });
        
        updateTargetLayers();
      }

      function runPattern() {
        if (patternRunning) return;
        
        try {
          const code = patternCodeEditor.value;
          
          // Clear previous instance
          if (currentP5Instance) {
            currentP5Instance.remove();
          }
          
          // Create new P5 instance
          const sketch = new Function('p', `
            ${code}
            
            p.setup = setup;
            p.draw = draw;
          `);
          
          currentP5Instance = new p5(sketch, patternPreviewContainer);
          patternRunning = true;
          patternStatus.textContent = 'RUNNING';
          
          // FPS monitoring
          const fpsInterval = setInterval(() => {
            if (currentP5Instance && patternRunning) {
              patternFPS = Math.round(currentP5Instance.frameRate());
              patternFPSDisplay.textContent = patternFPS + ' FPS';
            } else {
              clearInterval(fpsInterval);
            }
          }, 1000);
          
        } catch (error) {
          console.error('Pattern execution error:', error);
          patternStatus.textContent = 'ERROR';
        }
      }

      function stopPattern() {
        if (currentP5Instance) {
          currentP5Instance.remove();
          currentP5Instance = null;
        }
        patternRunning = false;
        patternStatus.textContent = 'STOPPED';
        patternFPSDisplay.textContent = '0 FPS';
        patternPreviewContainer.innerHTML = '';
      }

      function updateTargetLayers() {
        targetLayersList.innerHTML = '';
        let activeCount = 0;
        
        [...layersA, ...layersB].forEach(layer => {
          const layerCheckbox = document.createElement('div');
          layerCheckbox.className = 'target-layer-item';
          layerCheckbox.innerHTML = `
            <input type="checkbox" id="target-${layer.id}" data-layer-id="${layer.id}">
            <label for="target-${layer.id}">${layer.name}</label>
          `;
          
          const checkbox = layerCheckbox.querySelector('input');
          checkbox.addEventListener('change', () => {
            updateActiveTargetsCount();
          });
          
          targetLayersList.appendChild(layerCheckbox);
        });
        
        activeTargetsCount.textContent = activeCount;
      }

      function updateActiveTargetsCount() {
        const checkedBoxes = targetLayersList.querySelectorAll('input:checked');
        activeTargetsCount.textContent = checkedBoxes.length;
      }

      // Music Tab Functionality
      let musicLibraryTracks = [];
      let currentAudio = null;
      let isPlaying = false;
      let currentTrackIndex = -1;
      let audioContext = null;
      let analyser = null;
      let dataArray = null;

      const musicLibrary = document.getElementById('musicLibrary');
      const musicSearch = document.getElementById('musicSearch');
      const loadLocalMusicBtn = document.getElementById('loadLocalMusicBtn');
      const refreshMusicBtn = document.getElementById('refreshMusicBtn');
      const currentTrackTitle = document.getElementById('currentTrackTitle');
      const currentTrackArtist = document.getElementById('currentTrackArtist');
      const trackFormat = document.getElementById('trackFormat');
      const playPauseTrackBtn = document.getElementById('playPauseTrackBtn');
      const nextTrackBtn = document.getElementById('nextTrackBtn');
      const prevTrackBtn = document.getElementById('prevTrackBtn');
      const shuffleBtn = document.getElementById('shuffleBtn');
      const repeatBtn = document.getElementById('repeatBtn');
      const progressSlider = document.getElementById('progressSlider');
      const currentTime = document.getElementById('currentTime');
      const totalTime = document.getElementById('totalTime');
      const volumeSlider = document.getElementById('volumeSlider');
      const volumeValue = document.getElementById('volumeValue');
      const playerStatus = document.getElementById('playerStatus');
      const audioVisualizerCanvas = document.getElementById('audioVisualizerCanvas');

      // Initialize Music Tab
      async function initializeMusicTab() {
        try {
          console.log('üéµ Loading V3XV0ID music library...');
          
          // Load V3XV0ID cloud manager
          const V3XV0IDCloudManager = require('./supabase-config');
          const cloudManager = new V3XV0IDCloudManager();
          
          // Initialize cloud connection
          await cloudManager.initialize();
          
          // Get music tracks from v3xv0id-music bucket
          const cloudTracks = await cloudManager.getMusicTracks();
          console.log(`üé∂ Found ${cloudTracks.length} tracks in V3XV0ID cloud`);
          
          musicLibraryTracks = cloudTracks.map((track, index) => ({
            id: index,
            name: track.name.replace(/\.[^/.]+$/, ''),
            artist: 'V3XV0ID',
            format: track.name.split('.').pop().toUpperCase(),
            duration: '00:00', // Will be updated when loaded
            url: cloudManager.getPublicUrl('v3xv0id-music', track.name),
            size: track.metadata?.size || 'Unknown',
            created: track.created_at
          }));
          
          // Update cloud status
          const statusEl = document.getElementById('musicCloudStatus');
          if (statusEl) {
            statusEl.textContent = `‚úÖ CLOUD (${cloudTracks.length} TRACKS)`;
            statusEl.className = 'cloud-status connected';
          }
          
        } catch (error) {
          console.log('‚ö†Ô∏è Cloud music not available, using demo mode:', error.message);
          
          // Update cloud status
          const statusEl = document.getElementById('musicCloudStatus');
          if (statusEl) {
            statusEl.textContent = 'üé≠ DEMO MODE';
            statusEl.className = 'cloud-status demo';
          }
          // Demo tracks
          musicLibraryTracks = [
            { id: 0, name: 'ECHOES IN THE ABYSS', artist: 'V3XV0ID', format: 'MP3', duration: '03:45', url: null },
            { id: 1, name: 'DIGITAL SHADOWS', artist: 'V3XV0ID', format: 'MP3', duration: '04:12', url: null },
            { id: 2, name: 'CYBER DREAMS', artist: 'V3XV0ID', format: 'MP3', duration: '03:28', url: null },
            { id: 3, name: 'NEON PULSE', artist: 'V3XV0ID', format: 'MP3', duration: '04:56', url: null },
            { id: 4, name: 'DATA STREAM', artist: 'V3XV0ID', format: 'MP3', duration: '03:15', url: null }
          ];
        }
        
        renderMusicLibrary();
        initializeAudioVisualizer();
        console.log(`‚úÖ Music library loaded: ${musicLibraryTracks.length} tracks`);
      }

      function renderMusicLibrary() {
        musicLibrary.innerHTML = '';
        
        const filteredTracks = musicLibraryTracks.filter(track => 
          track.name.toLowerCase().includes(musicSearch.value.toLowerCase()) ||
          track.artist.toLowerCase().includes(musicSearch.value.toLowerCase())
        );
        
        filteredTracks.forEach(track => {
          const trackItem = document.createElement('div');
          trackItem.className = 'music-track-item';
          if (currentTrackIndex === track.id) {
            trackItem.classList.add('playing');
          }
          
          trackItem.innerHTML = `
            <div class="track-number">${track.id + 1}</div>
            <div class="track-details">
              <div class="track-name">${track.name}</div>
              <div class="track-meta">${track.artist} ‚Ä¢ ${track.format}</div>
            </div>
            <div class="track-duration">${track.duration}</div>
          `;
          
          trackItem.addEventListener('click', () => {
            playTrack(track.id);
          });
          
          musicLibrary.appendChild(trackItem);
        });
      }

      function initializeAudioVisualizer() {
        const canvas = audioVisualizerCanvas;
        const ctx = canvas.getContext('2d');
        
        function animate() {
          requestAnimationFrame(animate);
          
          ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          
          if (analyser && dataArray) {
            analyser.getByteFrequencyData(dataArray);
            
            const barWidth = canvas.width / dataArray.length;
            let x = 0;
            
            for (let i = 0; i < dataArray.length; i++) {
              const barHeight = (dataArray[i] / 255) * canvas.height;
              
              const hue = (i / dataArray.length) * 360;
              ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
              ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
              
              x += barWidth;
            }
          } else {
            // Placeholder animation when no audio
            const time = Date.now() * 0.001;
            for (let i = 0; i < 32; i++) {
              const barHeight = (Math.sin(time + i * 0.5) + 1) * 20 + 10;
              const x = (i / 32) * canvas.width;
              const hue = (i / 32) * 360;
              
              ctx.fillStyle = `hsl(${hue}, 50%, 30%)`;
              ctx.fillRect(x, canvas.height - barHeight, canvas.width / 32, barHeight);
            }
          }
        }
        
        animate();
      }

      // Composer Tab Functionality
      let isRecording = false;
      let recordingStartTime = 0;
      let recordedSequence = [];
      let sequenceLibraryData = [];

      const startRecordingBtn = document.getElementById('startRecordingBtn');
      const stopRecordingBtn = document.getElementById('stopRecordingBtn');
      const playSequenceBtn = document.getElementById('playSequenceBtn');
      const saveSequenceBtn = document.getElementById('saveSequenceBtn');
      const composerStatus = document.getElementById('composerStatus');
      const recordingTime = document.getElementById('recordingTime');
      const aiPrompt = document.getElementById('aiPrompt');
      const generateSequenceBtn = document.getElementById('generateSequenceBtn');
      const sequenceList = document.getElementById('sequenceList');

      // Initialize Composer Tab
      function initializeComposerTab() {
        // Set up AI presets
        document.querySelectorAll('.preset-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const preset = btn.getAttribute('data-preset');
            setAIPreset(preset);
          });
        });
        
        loadSequenceLibrary();
      }

      function setAIPreset(preset) {
        const presets = {
          'psychedelic': 'Create a psychedelic VJ sequence with swirling patterns, bright neon colors, kaleidoscope effects, and smooth transitions that pulse with electronic music',
          'minimal': 'Generate a minimal VJ sequence with clean geometric shapes, black and white patterns, subtle animations, and precise timing',
          'glitch': 'Design a glitch-style VJ sequence with digital artifacts, corrupted visuals, rapid cuts, static effects, and cyberpunk aesthetics',
          'cyberpunk': 'Build a cyberpunk VJ sequence with neon cityscapes, matrix-style effects, holographic patterns, and futuristic transitions'
        };
        
        aiPrompt.value = presets[preset] || '';
      }

      function startRecording() {
        isRecording = true;
        recordingStartTime = Date.now();
        recordedSequence = [];
        
        composerStatus.textContent = 'RECORDING';
        startRecordingBtn.disabled = true;
        stopRecordingBtn.disabled = false;
        
        // Start recording timer
        const recordingInterval = setInterval(() => {
          if (!isRecording) {
            clearInterval(recordingInterval);
            return;
          }
          
          const elapsed = Date.now() - recordingStartTime;
          const minutes = Math.floor(elapsed / 60000);
          const seconds = Math.floor((elapsed % 60000) / 1000);
          recordingTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
      }

      function stopRecording() {
        isRecording = false;
        composerStatus.textContent = 'READY';
        startRecordingBtn.disabled = false;
        stopRecordingBtn.disabled = true;
        playSequenceBtn.disabled = false;
        saveSequenceBtn.disabled = false;
      }

      function generateAISequence() {
        const prompt = aiPrompt.value.trim();
        if (!prompt) return;
        
        composerStatus.textContent = 'GENERATING...';
        generateSequenceBtn.disabled = true;
        
        // Simulate AI generation
        setTimeout(() => {
          const generatedSequence = createAISequence(prompt);
          recordedSequence = generatedSequence;
          
          composerStatus.textContent = 'SEQUENCE GENERATED';
          generateSequenceBtn.disabled = false;
          playSequenceBtn.disabled = false;
          saveSequenceBtn.disabled = false;
          
          // Visualize the generated sequence
          visualizeSequence(generatedSequence);
        }, 2000);
      }

      function createAISequence(prompt) {
        // AI sequence generation logic based on prompt
        const sequence = [];
        const duration = 60; // 60 seconds
        const events = Math.floor(duration / 4); // Event every 4 seconds
        
        for (let i = 0; i < events; i++) {
          const time = i * 4;
          const eventType = Math.random() > 0.5 ? 'pattern' : 'image';
          
          sequence.push({
            time: time,
            type: eventType,
            action: eventType === 'pattern' ? 'load_pattern' : 'load_image',
            data: {
              name: `AI_${eventType.toUpperCase()}_${i + 1}`,
              prompt: prompt
            }
          });
        }
        
        return sequence;
      }

      function visualizeSequence(sequence) {
        // Clear existing timeline
        document.getElementById('patternsTrack').innerHTML = '';
        document.getElementById('imagesTrack').innerHTML = '';
        document.getElementById('videosTrack').innerHTML = '';
        document.getElementById('effectsTrack').innerHTML = '';
        
        sequence.forEach(event => {
          const eventElement = document.createElement('div');
          eventElement.className = 'timeline-event';
          eventElement.style.cssText = `
            position: absolute;
            left: ${(event.time / 60) * 100}%;
            width: 20px;
            height: 20px;
            background: ${event.type === 'pattern' ? '#ff6b6b' : '#4ecdc4'};
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: crosshair;
          `;
          eventElement.title = `${event.time}s: ${event.data.name}`;
          
          const trackElement = document.getElementById(
            event.type === 'pattern' ? 'patternsTrack' : 'imagesTrack'
          );
          trackElement.style.position = 'relative';
          trackElement.appendChild(eventElement);
        });
      }

      function loadSequenceLibrary() {
        // Load saved sequences from localStorage
        const saved = localStorage.getItem('v3xv0id-sequences');
        sequenceLibraryData = saved ? JSON.parse(saved) : [];
        
        renderSequenceLibrary();
      }

      function renderSequenceLibrary() {
        sequenceList.innerHTML = '';
        
        sequenceLibraryData.forEach((sequence, index) => {
          const sequenceItem = document.createElement('div');
          sequenceItem.className = 'sequence-item';
          sequenceItem.innerHTML = `
            <div class="sequence-name">${sequence.name}</div>
            <div class="sequence-meta">${sequence.duration}s ‚Ä¢ ${sequence.events} events</div>
            <button onclick="loadSequence(${index})">LOAD</button>
            <button onclick="deleteSequence(${index})">DELETE</button>
          `;
          
          sequenceList.appendChild(sequenceItem);
        });
      }

      // Event Listeners
      if (loadLocalVideosBtn) {
        loadLocalVideosBtn.addEventListener('click', () => {
          // File dialog for local videos
          dialog.showOpenDialog({
            properties: ['openFile', 'multiSelections'],
            filters: [
              { name: 'Videos', extensions: ['mp4', 'mov', 'avi', 'webm', 'mkv'] }
            ]
          }).then(result => {
            if (!result.canceled) {
              result.filePaths.forEach((filePath, index) => {
                const fileName = path.basename(filePath);
                videoLibrary.push({
                  id: videoLibrary.length,
                  name: fileName,
                  url: filePath,
                  source: 'local',
                  format: fileName.split('.').pop().toUpperCase()
                });
              });
              renderVideoLibrary();
            }
          });
        });
      }

      if (loadLocalImagesBtn) {
        loadLocalImagesBtn.addEventListener('click', () => {
          // File dialog for local images
          dialog.showOpenDialog({
            properties: ['openFile', 'multiSelections'],
            filters: [
              { name: 'Images', extensions: ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'] }
            ]
          }).then(result => {
            if (!result.canceled) {
              result.filePaths.forEach((filePath, index) => {
                const fileName = path.basename(filePath);
                imageLibrary.push({
                  id: imageLibrary.length,
                  name: fileName,
                  url: filePath,
                  source: 'local',
                  format: fileName.split('.').pop().toUpperCase()
                });
              });
              renderImageLibrary();
            }
          });
        });
      }

      if (loadLocalMusicBtn) {
        loadLocalMusicBtn.addEventListener('click', () => {
          // File dialog for local music
          dialog.showOpenDialog({
            properties: ['openFile', 'multiSelections'],
            filters: [
              { name: 'Audio', extensions: ['mp3', 'wav', 'ogg', 'flac', 'm4a'] }
            ]
          }).then(result => {
            if (!result.canceled) {
              result.filePaths.forEach((filePath, index) => {
                const fileName = path.basename(filePath);
                musicLibraryTracks.push({
                  id: musicLibraryTracks.length,
                  name: fileName.replace(/\.[^/.]+$/, ''),
                  artist: 'LOCAL',
                  format: fileName.split('.').pop().toUpperCase(),
                  duration: '00:00',
                  url: filePath
                });
              });
              renderMusicLibrary();
            }
          });
        });
      }

      // Pattern controls
      if (runPatternBtn) runPatternBtn.addEventListener('click', runPattern);
      if (stopPatternBtn) stopPatternBtn.addEventListener('click', stopPattern);
      
      // Composer controls
      if (startRecordingBtn) startRecordingBtn.addEventListener('click', startRecording);
      if (stopRecordingBtn) stopRecordingBtn.addEventListener('click', stopRecording);
      if (generateSequenceBtn) generateSequenceBtn.addEventListener('click', generateAISequence);

      // Search functionality
      if (videoSearch) videoSearch.addEventListener('input', renderVideoLibrary);
      if (imageSearch) imageSearch.addEventListener('input', renderImageLibrary);
      if (musicSearch) musicSearch.addEventListener('input', renderMusicLibrary);

      // Preview panel close buttons
      if (closeVideoPreview) closeVideoPreview.addEventListener('click', () => {
        videoPreviewPanel.style.display = 'none';
      });
      if (closeImagePreview) closeImagePreview.addEventListener('click', () => {
        imagePreviewPanel.style.display = 'none';
      });

      // Tab switching with initialization
      const originalTabSwitching = tabButtons.forEach;
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          const targetTab = button.getAttribute('data-tab');
          
          // Initialize tab content when first opened
          if (targetTab === 'videos' && videoLibrary.length === 0) {
            initializeVideosTab();
          } else if (targetTab === 'images' && imageLibrary.length === 0) {
            initializeImagesTab();
          } else if (targetTab === 'patterns') {
            initializePatternsTab();
          } else if (targetTab === 'music' && musicLibraryTracks.length === 0) {
            initializeMusicTab();
          } else if (targetTab === 'composer') {
            initializeComposerTab();
          }
        });
      });

      console.log('üéõÔ∏è All V3XV0ID Tab Content Systems initialized');
    });
  </script>
</body>
</html>